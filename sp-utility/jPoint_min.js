(function(){function c(e,t,n,r){try{var i=new Array;i.push("<?xml version='1.0' encoding='utf-8'?>");i.push("<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>");i.push("<soap:Body>");i.push(n);i.push("</soap:Body>");i.push("</soap:Envelope>");$.ajax({async:false,type:"POST",url:e,contentType:"text/xml; charset=utf-8",processData:false,data:i.join(""),dataType:"xml",beforeSend:function(e){e.setRequestHeader("X-Vermeer-Content-Type","text/xml; charset=utf-8");e.setRequestHeader("SOAPAction",t)},success:r,error:function(e,t,n){}})}catch(s){}}function p(e,t,n,r){try{var i=new Array;i.push("<?xml version='1.0' encoding='utf-8'?>");i.push("<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>");i.push("<soap:Body>");i.push(n);i.push("</soap:Body>");i.push("</soap:Envelope>");$.ajax({async:false,type:"POST",url:e,contentType:"text/xml; charset=utf-8",processData:false,data:i.join(""),dataType:"xml",beforeSend:function(e){e.setRequestHeader("X-Vermeer-Content-Type","text/xml; charset=utf-8");e.setRequestHeader("SOAPAction",t)},success:r,error:r})}catch(s){}}function d(e,n,r,i,s){var o=new Array;try{o.push('<GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">');o.push("<listName>"+e+"</listName>");if(n.toLowerCase().indexOf("<query")>=0){n=n.replace("<Query>",'<query><Query xmlns="">');n=n.replace("</Query>","</Query></query>");n=n.replace("<ViewFields>",'<viewFields><ViewFields xmlns="">');n=n.replace("</ViewFields>","</ViewFields></viewFields>");n=n.replace("<QueryOptions>",'<queryOptions><QueryOptions xmlns="">');n=n.replace("</QueryOptions>","</QueryOptions></queryOptions>");n=n.replace("<RowLimit","<rowLimit");n=n.replace("</RowLimit>","</rowLimit>");o.push(n)}else{if(n!=null&&n!=""){o.push('<query><Query xmlns="">');o.push(n);o.push("</Query></query>")}if(r!=null&&r.length>-1){o.push('<viewFields><ViewFields xmlns="">');$.each(r,function(e,t){o.push('<FieldRef Name="'+t["internalName"]+'"/>')});o.push("</ViewFields></viewFields>")}if(i!=t&&i!=null&&i>0)o.push("<rowLimit>"+i+"</rowLimit>");else o.push("<rowLimit>100000</rowLimit>");o.push('<queryOptions><QueryOptions xmlns=""><IncludeMandatoryColumns>FALSE</IncludeMandatoryColumns>');if(s!=t&&s!=null&&s!="")o.push('<Paging ListItemCollectionPositionNext="'+s.replace(/&/g,"&")+'" />');o.push("</QueryOptions></queryOptions>")}o.push("</GetListItems>")}catch(u){alert("buildQueryContent Error:"+u.description)}var a=o.join("");return a}function v(e,t){var n=new Array;try{n.push('<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">');n.push("<listName>"+e+"</listName>");n.push('<updates><Batch OnError="Continue" xmlns="">');for(var r=0;r<t.length;r++){var i=0;if(t[r].id!=null){i=t[r].id}if(t[r].ID!=null){i=t[r].ID}if(i<1){n.push('<Method ID="1" Cmd="New">')}else{n.push('<Method ID="1" Cmd="Update">');n.push('<Field Name="ID">'+i+"</Field>")}var s=t[r];$.each(s,function(e,t){if(e.toLowerCase()!="id"){n.push('<Field Name="');n.push(e);n.push('"><![CDATA[');n.push(t);n.push("]]></Field>")}});n.push("</Method>")}n.push("</Batch></updates></UpdateListItems>")}catch(o){alert("buildModifyContent Error:"+o.description)}var u=n.join("");return u}function m(e,t){var n=new Array;try{n.push('<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">');n.push("<listName>"+e+"</listName>");n.push('<updates><Batch OnError="Continue" xmlns="">');n.push('<Method ID="1" Cmd="Delete">');n.push('<Field Name="ID">'+t+"</Field>");n.push("</Method>");n.push("</Batch></updates></UpdateListItems>")}catch(r){}var i=n.join("");return i}function g(e,n,r){try{var i="FieldInternalName";var o="FieldName";var u="FieldType";var a="Specify your own value";var f=n;var l=r;this.FieldInternalName=i;this.FieldName=o;this.FieldType=u;this.SpecifyOtherField=a;this.Item=$(e.parentNode).find("span").get(0);this.ItemRow=e.parentNode.parentNode;this.ItemIndex=t;var c=new RegExp('"');var p=e.innerHTML.split(c);var d=null;for(var v=0;v<p.length;v++){d=p[v].split("=");if(d.length>0){if(d[0].indexOf(i)>=0){this.InternalName=p[v+1]}else if(d[0].indexOf(o)>=0){this.Name=p[v+1]}else if(d[0].indexOf(u)>=0){this.Type=p[v+1]}}}function m(){this.ItemRow.style.display="none";return this}function g(){this.ItemRow.style.display="";return this}function y(e){var n,i,s;try{if(e!==t&&e!="oldValHint"){i=new String('var jOV = new jPoint(); jOV.Form.readForm("'+f+'","'+r+'").'+this.Name+".val(jOV.Form."+this.Name+".oldVal()); $(this).parent().hide(); jOV = null;");n="<a class='oldValCopyLink' onclick='"+i+"' title='Swap previous value'><img style='border: 0px; margin-right: 4px; position: relative; top: 2px' src='/_layouts/images/recyclebinrestore.gif' title='Copy this into field'/></a><span class='oldValDiv'>"+e+"</span>";$(this.Item).data("oldVal",e).data("oldValHint",n).addClass("oldVal").parent().addClass("oldValCell");s=this}else{s=e=="oldValHint"?$(this.Item).data("oldValHint"):$(this.Item).data("oldVal");if(!s){s=""}}}catch(o){}return s}function b(e,n){var r=n||true;if(n===false){r=false}var i,s;try{if(e!==t){s=doVal(t,this);if(r&&s!=e&&s!=t){this.oldVal(s)}i=doVal(e,this)}else{i=doVal(t,this)}}catch(o){}return i}doVal=function(e,n){var r=null;var i;try{if($(".jPointField",n.ItemRow).find(".datefield").length==0){i=$(".jPointField",n.ItemRow).find(":input:visible").addClass("jPointFieldInput")}else{i=$(".jPointField",n.ItemRow).find(":input:first").addClass("jPointFieldInput")}if(i.length<1)i=$(".jPointField",n.ItemRow).find(":input").addClass("jPointFieldInput");if($(n.Item).find(".ms-rtelong").contents().find("body").html()!=null){if(e!==t){$(n.Item).find("textarea:eq(0)").text(e);$(n.Item).find(".ms-rtelong").contents().find("body").html("<div>"+e+"</div>")}else{if($(n.Item).find(".ms-rtelong").contents().find("body").html()!=null){r=$(n.Item).find(".ms-rtelong").contents().find("body").html()}else{r=$(n.Item).find("textarea:eq(0)").text();if(r.length==0){r=$(n.Item).find("textarea:eq(0)").get(0).innerHTML}}}}else if(n.Type=="HiddenUserFieldValue"){if(e!==t){$(n.ItemRow).find(".ms-inputuserfield").html(e);$(document).ready(function(){$($(n.ItemRow).find("a[title=Check Names]").get(0)).click()})}else{r=$(n.ItemRow).find("textarea").attr("value");if(r.length==0){r=$(n.ItemRow).find(".ms-inputuserfield").html()}}}else if(i.length==1&&$(i[0]).attr("type")!="checkbox"){if(e!==t){if(i[0].nodeName!="TEXTAREA"){$(i[0]).val(e);$(i[0]).change()}else if(n.Type=="Lookup"&&e==""){i[0].value=0}else{i[0].value=e}}else{if(n.Type=="Lookup"){r=[];r.push($(i).find(":selected").val());r.push($(i).find(":selected").text());r=r.join(";#")}else{r=$(i[0]).val()}}}else if(i.length==2&&n.Type=="UrlControlId"){if(e!==t){if(e==""){e=["",""]}$(i[0]).val(e[0]);$(i[1]).val(e[1])}else{r=[$(i[0]).val(),$(i[1]).val()]}}else if(i.length>=1&&n.Type=="DateTimeField"){if(e!==t){handleDate(i,e)}else{r=handleDate(i)}}else if($(i[0]).attr("type")=="checkbox"){if(e!==t){if(e==""||e=="No"||e=="0"){e=false}if(e=="Yes"||e=="1"){e=true}handleCheckbox(i,e)}else{r=handleCheckbox(i)}}else if($(i[0]).attr("type")=="radio"){if(e!==t){handleRadio(i,e)}else{r=handleRadio(i)}}else if(n.Type=="MultiLookupPicker"){if(e!==t){if(e==""){e=false}handleMultLookup(i,e)}else{r=handleMultLookup(i)}}else{if(e!==t){i[0].value=e}else{if(i.length<1){r=handleNonInput(n)}else{r=$(i[0]).val()}}}}catch(s){alert("Val() Error: "+s.message)}if(e){r=n}return r};handleNonInput=function(e){var t=$(e.Item).html();t=t.replace(/[\n\r\t\xA0]/g,"");t=t.replace(/<!--.*-->/,"");t=t.replace("&nbsp;","");t=$.trim(t);return t};handleDate=function(e,n){var r;var i=false;try{var s=$(e[0]).val()+" ";$(e).each(function(e){if(e>0){s+=$(this).val()}});var o=/^([\d]{1,2})\/([\d]{1,2})\/([\d]{4}) $/;var u=/^([\d]{1,2})\/([\d]{1,2})\/([\d]{4}) ([\d]{1,2}) ([AP]M)([\d]{1,2})$/;var a=s.match(u);if(a){h=a[4];if(a[5]=="AM"&&h=="12")h="00";else if(a[5]=="PM"&&h!="12")h=parseInt(h)+12;r=a[3]+"-"+a[1]+"-"+a[2]+"T"+h+":"+a[6]+":00Z"}else{var a=s.match(o);if(a){r=a[3]+"-"+a[1]+"-"+a[2]}else{}}}catch(f){alert("handleDate Error:"+f.description)}if(n!==t){if(typeof n=="object"){var l=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();var c=n.getHours();if(c==0)m="12 AM";else if(c==12)m="12 PM";else if(c>=13)m=c-12+" PM";else m=c+" AM";var p=n.getMinutes();p=p-p%5;var d=p+"";$(e[0]).val(l);if($(e).length>1){$(e[1]).val(m);$(e[2]).val(d)}}else if(typeof n=="string"){var o=/^([\d]{1,2})\/([\d]{1,2})\/([\d]{4})$/;var u=/^([\d]{4})-([\d]{1,2})-([\d]{1,2})T([\d]{1,2}):([\d]{1,2}):([\d]{1,2})Z$/;var v=/^([\d]{4})-([\d]{1,2})-([\d]{1,2})$/;var l="";var m="";var d="";var a=n.match(o);if(a){l=n}else{var a=n.match(u);if(a){l=a[2]+"/"+a[3]+"/"+a[1];var c=parseInt(a[4]);if(c==0)m="12 AM";else if(c==12)m="12 PM";else if(c>=13)m=c-12+" PM";else m=c+" AM";var p=parseInt(a[5]);p=p-p%5;d=p+""}else{var a=n.match(v);if(a){l=a[2]+"/"+a[3]+"/"+a[1]}}}$(e[0]).val(l);if($(e).length>1){$(e[1]).val(m);$(e[2]).val(d)}}else{alert("handleDate Error: Invalid date/time value")}r=i}return r};handleMultLookup=function(e,n){var r=false;var i,s,o,u=null;var a=[];try{i=$(e).closest(".jPointField").find("span");if(n!=t){s=i.find("SELECT")[0];o=i.find("SELECT")[1];u="";a=[];if(n===false){s=o;o=i.find("SELECT")[0]}else if(n===true){n=false}else if(n.constructor!=Array){n=[n,""];u=n.join(":")}else{u=n.join(":")}for(v=s.length-1;v>=0;v--){if(n===false||u.indexOf(s[v].text)>=0){var f=new Option(s[v].text,s[v].value);var l=o.options[o.length>0?o.length-1:0];try{o.add(f,l)}catch(h){o.add(f,o.length>0?o.length-1:0)}a.push(v);r=true}}var p=a.length;for(c=0;c<p;c++){s.remove(a[c])}}else{o=i.find("SELECT")[1];r=[];for(j=0;j<o.length;j++){r.push($(o[j]).val());r.push($(o[j]).text())}r=r.join(";#")}}catch(d){}return r};handleCheckbox=function(e,n){var r=[];var i=false;var o,u=null;var f=[];var l=false;try{if(n===t||n.constructor==Array){o=n}else if(n===true||n===false){o=[n]}else if(n.indexOf(",")>0){o=n.replace(/,/g,",true,")+",true";o=o.split(",")}else if(n.length>0){o=n+",true";o=o.split(",")}else{throw"value parameter is invalid: "+n+".  value needs to be an Array of value pairs, comma delimited string, true, or false"}if(o){for(v=0;v<o.length;v=v+2){l=false;e.each(function(t){var r,f;u=$(this).parent().attr("title");if(u==""){u=n}if(n===true||n===false){r=u;f=n}else{r=o[v];f=o[v+1]}if(s.sameNames(u,r)){$(this).attr("checked",f);if($(this).attr("title").indexOf(a)>-1&&n===false){$(e).eq(e.length-1).val("")}i=true;l=true}});if(!l){f.push(o[v])}}if(f.length>0&&$(e).eq(e.length-2).parent().attr("title").indexOf(a)>-1){$(e).eq(e.length-2).attr("checked",true);$(e).eq(e.length-1).val(f.join(","));i=true}}else{e.each(function(t){u=$(this).parent().attr("title");if(u==""&&t==0){r=$(this).attr("checked")==true?"1":"0"}else if($(this).attr("checked")==true){if(u.indexOf(a)>-1){r.push($(e[t+1]).val())}else{r.push(u)}}})}}catch(c){}if(n!==t){r=i}else{if(r.length<1){r=false}}return r};handleRadio=function(e,n){var r;var i=false;var o=false;try{if($("*:selected",e).length>0){o=true}e.each(function(u){var f,l;label=$(this).parent().attr("title");if(n!==t){if(o){if($(this).find("option").length>0){$(e[u-1]).attr("checked",true);$(this).find("option").each(function(t){if(n==""&&t==0){$(this).attr("selected",true);i=true;$(e).eq(e.length-1).val(n);return false}if(s.sameNames($(this).val(),n)){$(this).attr("selected",true);i=true;return false}});if(i==true){return false}}}else{if(n==""&&u==0){$(this).attr("checked",true);$(e).eq(e.length-1).val("");i=true;return false}if(s.sameNames(label,n)){$(this).attr("checked",true);i=true;return false}}}else{if($(this).attr("checked")===true){if(o||label&&label.indexOf(a)>-1){l=$(e[u+1]).val();r=l}else{r=label}}}});if(n!==t&&!i&&$(e).eq(e.length-2).parent().attr("title").indexOf(a)>-1){$(e).eq(e.length-2).attr("checked",true);$(e).eq(e.length-1).val(n);i=true}}catch(u){}if(n!==t){r=i}return r};function w(e){var n=t;var r=$(this.ItemRow);switch(e.toString().toLowerCase()){case":itemrow":n=r;break;case":itemlabel":n=r.children(":first-child");break;case":itemdata":n=r.children(":nth-child(2)");break;case":iteminputs":e=e.replace(":iteminputs","");n=r.find(":nth-child(2)").find("input,textarea,select "+e);break;default:n=r.find(e)}return n}function E(e){if(typeof e!="undefined")var t=this.find(":iteminputs"+e);else var t=this.find(":iteminputs");var n=[];$.each(t,function(e,t){var r=t.id;r=r.substr(r.lastIndexOf("_ctl00_")+7);n.push(r)});t["inputids"]=n;return t}this.hide=m;this.show=g;this.oldVal=y;this.val=b;this.find=w;this.inputs=E}catch(S){}}var e=this,t,n=e.jPoint,r=e.jP,s=e.jPoint=e.jP=function(){return new s.fn.init},o="FieldInternalName",u="FieldName",a="FieldType",f=null;s.Jpoint="0.8";s.getScript=function(e,t,n){try{$.ajaxSetup({async:!t});$.getScript(e,n);$.ajaxSetup({async:true});return true}catch(r){return false}};s.valSiteURL=function(e){var n="";if(e!=t){s.SiteURL=e;n=e}else{if(s.SiteURL!="undefined"&&s.SiteURL!=null){n=s.SiteURL}else if(typeof L_Menu_BaseUrl!="undefined"&&L_Menu_BaseUrl!=null){n=L_Menu_BaseUrl;s.SiteURL=unescape(n)}}return n};s.valListName=function(e){var n="";var r=location.href.substr(0,location.href.indexOf("/Lists"));if(e!=t){s.ListName=e;n=e}else{if(s.ListName!="undefined"&&s.ListName!=null){n=s.ListName}else if($.trim($("title").html().replace(/\n/g,"")).length>0){n=$.trim($.trim($("title").html().replace(/\n/g,"")).split("-")[0]);s.ListName=n}else if(location.href.indexOf("/Lists/")>0){n=location.href.substr(r.length+7,location.href.substr(r.length+7).indexOf("/"));s.ListName=unescape(n)}}return n};s.strip=function(e){var t=e;try{if(e){t=t.replace(/_x[0-9A-Fa-f]{4}_/g,"");t=t.replace(/[^a-zA-Z0-9]/g,"")}}catch(n){}return t};s.sameNames=function(e,t){var n=false;try{if(e==t){n=true}else if(this.strip(e)==this.strip(t)){n=true}}catch(r){}return n};s.fn=s.prototype={init:function(){f=this;return this}};s.fn.init.prototype=s.fn;s.fn.Lists=s.prototype.Lists=s.Lists=function(){this.Lists.Items=new Array;this.Lists.FieldCount=0;this.Lists.getList=this.Lists.setSPObject=function(e,t){function o(e){try{e.Items=null;var t=d(e.ListName,e.CamlQuery,e.ViewFields||"",1,e.pagingInfo);c(e.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/GetListItems",t,function(t){h(e,t)})}catch(n){alert("getSPItemData Error:"+n.description)}}function u(e,t){try{var n=d(e.ListName,e.CamlQuery,e.ViewFields,t,e.pagingInfo);c(e.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/GetListItems",n,function(t){h(e,t)})}catch(r){alert("getSPItems Error:"+r.description)}}function a(e){var t=[];var n;for(var r=0;r<e.length;r++){var s=e[r].attributes;t[r]={};for(i=0;i<s.length;i++){n=s[i].name.replace(/ows_/i,"").replace(/_x0020_/g,"");t[r][n]=s[i].value}}return t}function l(e){try{var t='<GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+e.ListName+"</listName></GetViewCollection>";c(e.SiteURL+"views.asmx","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection",t,function(n){if(e.ViewName.length==0){e.ViewName=$(n).find("View[DefaultView='TRUE']").attr("DisplayName")}var r=$(n).find("View[DisplayName='"+e.ViewName+"']");if(r.attr("Name")!=null){var i=r.attr("Name");t="<GetView xmlns='http://schemas.microsoft.com/sharepoint/soap/'><listName>"+e.ListName+"</listName><viewName>"+i+"</viewName></GetView>";c(e.SiteURL+"views.asmx","http://schemas.microsoft.com/sharepoint/soap/GetView",t,function(t){var n=$(t).find("View").get(0).xml;if(n==null)n=(new XMLSerializer).serializeToString($(t).find("View").get(0));var r=n.indexOf("Query")-1;n=n.substr(r,n.length-r);n=n.replace("</View>","");e.CamlQuery=n;u(e,0)})}else{alert("'"+e.ViewName+"' view does not exist in '"+e.ListName+"' list.")}})}catch(n){alert("getSPItem Error:"+n.description)}}function h(e,t){e.xmlDoc=t;var n=$("row",t);if(n.get(0)==null)n=$("z\\:row",t);e.JQueryData=n;if($("rs\\:data",t).length>0){e.total=$("rs\\:data",t)[0].attributes[0].value;if($("rs\\:data",t)[0].attributes.length>1)e.nextPage=$("rs\\:data",t)[0].attributes[1].value}if(n.get(0)!=null){p(e,n)}}function p(e,t){var n=t.get(0).attributes;if(n.length>0)e.Fields=[];s.Lists.ListName=e.ListName.toUpperCase();e.Items=a(t);var r=g(e.Items);var i="";$.each(r,function(t,n){e.Fields.push(n);i=n.replace(/ows_/i,"").replace(/_x0020_/g,"");var r=e.ListName.toUpperCase()+"."+i;if($.inArray(r,s.Lists.Items)==-1)s.Lists.Items.push(r)});var o=e.Fields.length;s.Lists.FieldCount=o;e.FieldCount=o;var u=e.Items.length;s.Lists.ItemCount=u;e.ItemCount=u}function g(e){var t={};$.each(e,function(e,n){$.each(n,function(e,n){t[e]=e})});return t}if(e.split("/").length<=1){t=e;e=s.valSiteURL()}var n=t.toUpperCase();var r=f.Lists[n]=new Object;if(e.length!=e.replace(/\/_vti_bin/i,"").length)e=e+"/";else if(e.substring(e.length-1)=="/")e=e+"_vti_bin/";else e=e+"/_vti_bin/";r.SiteURL=e;r.ListName=t;r.CamlQuery="";r.extend=jQuery.extend;r.extend({getSchema:function(){try{var e=this;c(e.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/GetListContentTypes",'<GetListContentTypes xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+e.ListName+"</listName><contentTypeId></contentTypeId></GetListContentTypes>",function(t){var n=$(t).find("ContentType").eq(0).attr("ID");c(e.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/GetListContentType",'<GetListContentType xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+e.ListName+"</listName><contentTypeId>"+n+"</contentTypeId></GetListContentType>",function(t){s.Lists.ListName=e.ListName.toUpperCase();e.xmlDoc=t;var n=$(t).find("Field");e.Schema=new Array;$.each(n,function(t,n){var r={};r["FieldName"]=$(n).attr("DisplayName");r["FieldInternalName"]=$(n).attr("StaticName");r["FieldType"]=$(n).attr("Type");r["FieldDescription"]=$(n).attr("Description");r["FieldRequired"]=$(n).attr("Required")=="TRUE"||false;r["FieldDefault"]=$(n).children().length>0?$(n).children("Default").text():"";r["FieldXML"]=n;e.Schema.push(r)})})})}catch(t){}return e},getSPListFields:function(){return this.getSchema()},getSPItemByID:function(e){try{var t=null;this.CamlQuery="<Where><Eq><FieldRef Name='ID' /><Value Type='Counter'>"+e+"</Value></Eq></Where>";o(this);if(this.Items&&this.Items.length>0){t=this.Items[0]}return t}catch(n){alert("getSPItem Error:"+n.description)}},getSPItem:function(e){return this.getSPItemByID(e)},getSPItemsWithQuery:function(e,t){try{this.CamlQuery=e;u(this,t);return this}catch(n){alert("getSPItemsWithQuery Error:"+n.description)}},updateItem:function(e){var t={success:false,errorCode:"",errorText:"internal error",id:-1};try{var n=this;var r=v(n.ListName,e);c(n.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",r,function(e){h(n,e);if($("ErrorText",e).length>0){t.success=false;t.errorCode=$("ErrorCode",e).text();t.errorText=$("ErrorText",e).text();t.id=t.ID=-1}else{t.success=true;t.errorCode="0x00000000";t.errorText=null;t.id=t.ID=$("z\\:row",e).attr("ows_ID")}})}catch(i){alert("updateItem Error:"+i)}return t},addItem:function(e){return this.updateItem(e)},deleteItem:function(e){var t={success:false,errorCode:"",errorText:"internal error"};try{var n=this;var r=m(n.ListName,e);c(n.SiteURL+"lists.asmx","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",r,function(e){if($("ErrorText",e).length>0){t.success=false;t.errorCode=$("ErrorCode",e).text();t.errorText=$("ErrorText",e).text()}else{t.success=true;t.errorCode="0x00000000";t.errorText=null}})}catch(i){}return t},getSPViewCollection:function(){try{var e='<GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.ListName+"</listName></GetViewCollection>";var t=this;c(this.SiteURL+"views.asmx","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection",e,function(e){t.xmlDoc=e;var n=$("View",e);if(n.length>0)p(t,n)});return t}catch(n){alert("getSPViewCollection Error:"+n.description)}},getSPView:function(e){try{if(e==null)e="";this.ViewName=e;l(this);return this}catch(t){alert("getSPView Error:"+t.description)}},getPictures:function(e){try{if(e==null)e="";this.ViewName=e;l(this);return this}catch(t){alert("getPictures Error:"+t.description)}},filterItems:function(e,t){try{t=t.toUpperCase();var n=$.grep(this.Items,function(n,r){if(typeof n[e]!="undefined"){return n[e].toUpperCase().indexOf(t)>=0}});return n}catch(r){alert("filterItems Error:"+r.description)}},getItemsFieldData:function(e){try{var t=[];$.each(this.Items,function(){var n=this;var r={};$.each(e,function(){var e=this;r[e]=n[e]});t.push(r)});return t}catch(n){}}});return r};return this.Lists};s.fn.Form=s.prototype.Form=s.Form=function(e,n){this.Form.Items=new Array;this.Form.ItemNames=new Array;this.Form.FieldCount=0;this.Form.id=0;this.Form.AutoSaveInterval=0;this.Form.Schema=null;this.Form.readForm=function(e,t){try{if(s.Form.Items.length>0){return s.Form}var n=null;var r=0;var u=[];var a,l="";s.valSiteURL(e);s.valListName(t);a=f.SiteURL;l=s.ListName;if(a==""||l==""){throw"A site URL [siteURL] and list name [schemaListName] is a required parameter when calling jPoint.Form.readForm on a page that does not have '/Lists' in the URL."}u=$("div.commentsNode");if(u.length<1){u=i()}s.Form.Items=new Array;s.Form.ItemNames=new Array;s.Form.FieldCount=0;for(var c=0;c<u.length;c++){if(u[c].innerHTML.indexOf(o)>0){n=new g(u[c]);r=s.Form.Items.length;n.ItemIndex=r;s.Form.Items[r]=n;s.Form[n.InternalName]=n;s.Form[n.Name]=n;s.Form[s.strip(n.Name)]=n;s.Form.ItemNames.push("Form."+s.strip(n.InternalName))}}s.Form.FieldCount=s.Form.Items.length}catch(h){alert("An error occurred when reading the form. "+h);return false}return s.Form};this.Form.saveForm=function(){try{var e=s.SiteURL;var t=s.ListName;if(f.Form.ID==-1){f.Form.ID=0}else if(location.href.indexOf("ID=")>-1&&f.Form.ID<1){var n=location.href.substr(location.href.indexOf("ID=")+3).indexOf("&");var r=0;if(n>-1)r=location.href.substr(location.href.indexOf("ID=")+3,n);else r=location.href.substr(location.href.indexOf("ID=")+3);if(r>0)f.Form.ID=r}s.Form.readForm();if(s.Form.Items.length>0){var i=s.Lists.setSPObject(e,t);var o=null;var u={};u["id"]=f.Form.ID||"0";for(var a=0;a<s.Form.Items.length;a++){o=s.Form.Items[a];if(o.InternalName.length>0){switch(o.Type){case"SPFieldDateTime":var l=new Date(o.val());u[o.InternalName]=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate()+" "+l.getHours()+":"+l.getMinutes()+":"+l.getSeconds()+"Z";break;case"SPFieldUser":var c=o.val();$.loginfo("User field length:"+c.length);if(c.length>0){var h=$("Div[data]",c).attr("data");$.loginfo("Data attribute:"+h);var p="";var d="";if(h.indexOf("SPUserID")>-1){p=h.substr(h.indexOf("SPUserID")+43);p=p.substr(0,p.indexOf("<"));d=h.substr(h.indexOf("DisplayName")+46);d=d.substr(0,d.indexOf("<"))}else{d=h.substr(h.indexOf("Email")+40);d=d.substr(0,d.indexOf("<"));d=d.substr(0,d.indexOf("@"));i.getUserProfile(d);p=i.User.ID}u[o.InternalName]=p+";#"+d}else{u[o.InternalName]=c}break;default:u[o.InternalName]=o.val();break}}}var v=new Array;v.push(u);s.Form.ID=i.addItem(v).ID;var m=$('input[type="button"][value="OK"]');if(m.length>0){$(m).each(function(){var e="var myJPObj=new jPoint(); jPoint.Form.ID = "+s.Form.ID+";myJPObj.Form.saveForm();";this.onclick=new Function(e)})}var g=$('input[type="button"][value="Cancel"]');if(g.length==0)g=$('input[type="button"][value="Save and Close"]');if(g.length>0){$(g).each(function(){var e="var myJPObj=new jPoint(); jPoint.Form.ID = "+s.Form.ID+';myJPObj.Form.saveForm();location.href=location.href.substr(location.href.indexOf("Source=") + 7) + "?Source=" + location.href.substr(location.href.indexOf("Source=") + 7)';this.onclick=new Function(e)})}}else{alert("saveForm only works on the New/Edit form page.")}}catch(y){alert("saveForm Error:"+y.description)}return s.Form};this.Form.field=function(e){var n=t;try{s.Form.readForm();var r=$(e).closest("TR .jPointRow");if(r.length>0){var i=r.attr("id");n=s.Form[i]}}catch(o){alert("An error occurred in Form.field(). "+o)}return n};s.fn.Webparts=s.prototype.Webparts=s.Webparts=function(){this.Webparts.getPageWebPartProperties=function(e,t){var n=new Object;n.SiteURL=L_Menu_BaseUrl+"/_vti_bin/";n.PageURL=e;if(n.PageURL.indexOf(".aspx")>-1){n.PageURL=n.PageURL.substr(0,n.PageURL.indexOf(".aspx")+5)}var r="";var i="";c(n.SiteURL+"WebPartPages.asmx","http://microsoft.com/sharepoint/webpartpages/GetWebPartProperties2",'<GetWebPartProperties2 xmlns="http://microsoft.com/sharepoint/webpartpages"><pageUrl>'+n.PageURL+"</pageUrl><storage>Shared</storage><behavior>Version3</behavior></GetWebPartProperties2>",function(e){$.each($(e).find("WebPart"),function(e,n){var s=n.text||n.textContent;if(s.indexOf(t.replace(/-/g,"_"))>-1){r=$(n.xml).attr("ID")||$(n).attr("ID");if(n.xml)i=n.xml.replace(/</g,"&lt;").replace(/>/g,"&gt;");else i=(new XMLSerializer).serializeToString(n).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\n/g,"\\n");return false}})});var s='&lt;?xml version="1.0" encoding="utf-16"?&gt;'+i;n.WebpartID=r;n.WebpartXMLStr=s;return n};this.Webparts.save=this.Webparts.Save=function(e,t){var n=e.WebpartXMLStr.substr(0,e.WebpartXMLStr.indexOf("[CDATA[")+7)+t.replace(/</g,"&lt;").replace(/>/g,"&gt;")+e.WebpartXMLStr.substr(e.WebpartXMLStr.indexOf("]]"),e.WebpartXMLStr.length);c(e.SiteURL+"WebPartPages.asmx","http://microsoft.com/sharepoint/webpartpages/SaveWebPart",'<SaveWebPart xmlns="http://microsoft.com/sharepoint/webpartpages"><pageUrl>'+e.PageURL+"</pageUrl><storageKey>"+e.WebpartID+"</storageKey><webPartXml>"+n+"</webPartXml><storage>Shared</storage></SaveWebPart>",function(e){})};this.Webparts.updatejPartProperties=function(e,t){var n=e.WebpartXMLStr.indexOf("var myjLocalOptions");var r="";if(n>-1){n+=19;var i=e.WebpartXMLStr.substring(n,e.WebpartXMLStr.length).indexOf(";&lt;/script&gt;")+n;r=e.WebpartXMLStr.substr(0,n)+"="+t.replace(/</g,"&lt;").replace(/>/g,"&gt;")+e.WebpartXMLStr.substr(i,e.WebpartXMLStr.length)}else{var s=e.WebpartXMLStr.indexOf("[CDATA[")+7;r=e.WebpartXMLStr.substr(0,s)+"&lt;script&gt;var myjLocalOptions="+t.replace(/</g,"&lt;").replace(/>/g,"&gt;")+";&lt;/script&gt;"+e.WebpartXMLStr.substr(s,e.WebpartXMLStr.length)}c(e.SiteURL+"WebPartPages.asmx","http://microsoft.com/sharepoint/webpartpages/SaveWebPart",'<SaveWebPart xmlns="http://microsoft.com/sharepoint/webpartpages"><pageUrl>'+e.PageURL+"</pageUrl><storageKey>"+e.WebpartID+"</storageKey><webPartXml>"+r+"</webPartXml><storage>Shared</storage></SaveWebPart>",function(e){location.reload(true)})};return this.Webparts};var r=function(e){var n=e;if(t!=s.Form.Schema){$.each(s.Form.Schema,function(t,r){if(s.sameNames(r.FieldName,e)){n=r.FieldInternalName;return false}})}else{throw"Form schema is not defined.  Check siteURL and schemaListName parameters to Form.readForm() call."}return n};var i=function(){try{var e,t,n,i;var l,c,h,p,d,v=null;var m;l=$("input[id$='_TextField']").closest("table").addClass("jPointTable");if(l.length==0){l=$("H3").closest("table").addClass("jPointTable")}c=l.children().children("[id!='idAttachmentsRow']").addClass("jPointRow").attr("id",function(e){if($(this).find("td").length>0)return s.strip($($(this).find("td").get(0).childNodes[0]).text());else return e});f.Lists.setSPObject(s.SiteURL,s.ListName);s.Form.Schema=s.Lists[s.ListName.toUpperCase()].getSPListFields().Schema;v=$("tr.jPointRow > td:nth-child(2)").each(function(t){e={};h=$(this).parent().attr("id");e[u]=h;m=/ctl\d{2}_.*_ctl\d{2}_([A-Z][a-zA-Z]+)/;try{p=m.exec($(this).find("*[id^='ctl']").get(0).id)[1]}catch(i){p="SPFieldChoice"}e[o]=h;e[a]=p;n=u+'="'+e.FieldName+'" '+o+'="'+r(e.FieldInternalName)+'" '+a+'="'+e.FieldType+'" ';if($(this).find("span").length<1&&$(this).find("#idAttachmentsTable").length<1){$(this).html("<span>"+$(this).html()+"</span>")}if($(this).find(".commentsNode").length<1){$(this).prepend("<div class='commentsNode' style='display: none'>"+n+"</div>").addClass("jPointField")}}).find("div.commentsNode");$("tr.jPointRow > td:nth-child(1)").each(function(e){})}catch(g){alert("getAlternativeComments Error: "+g.message)}return v};var l=function(e,t){var n=$(e).contents().filter(function(){var e=this==t;return e});if(n.length<=0){var r=$(e).children();if(r.length>0){for(var i=0;i<r.length;i++){var s=r[i];var o=l(s,t);if(o.length>0){n=o;break}}}}return n};return this.Form};s.fn.WebServices=s.prototype.WebServices=s.WebServices=function(){this.Result={};this.WebServices.GetWeb=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Webs",operationPath:t,operationName:"GetWeb",soapBody:"<webUrl>"+n.siteUrl+"</webUrl>",returnNode:"Web",filterNode:n.filterNode,filterAttr:n.filterAttr};var s=this.CallSPWebSvc(i);return s};this.WebServices.GetWebCollection=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Webs",operationPath:t,operationName:"GetWebCollection",soapBody:"",returnNode:"Web",filterNode:n.filterNode,filterAttr:n.filterAttr};var s=this.CallSPWebSvc(i);return s};this.WebServices.WebUrlFromPageUrl=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Webs",operationPath:t,operationName:"WebUrlFromPageUrl",soapBody:"<pageUrl>"+n.webUrl+"</pageUrl>",returnNode:"WebUrlFromPageUrlResult"};var s=this.CallSPWebSvc(i);return s};this.WebServices.GetAllSubWebCollection=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Webs",operationPath:t,operationName:"GetAllSubWebCollection",soapBody:"",returnNode:"Web",filterNode:n.filterNode,filterAttr:n.filterAttr};var s=this.CallSPWebSvc(i);return s};this.WebServices.GetListCollection=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Lists",operationPath:t,operationName:"GetListCollection",soapBody:"",returnNode:"List",filterNode:n.filterNode,filterAttr:n.filterAttr};var s=this.CallSPWebSvc(i);return s};this.WebServices.GetList=function(e){var n=r(e);var i={siteUrl:n.siteUrl,serviceName:"Lists",operationPath:t,operationName:"GetList",soapBody:"<listName>"+n.listName+"</listName>",returnNode:"List",filterNode:n.filterNode,filterAttr:n.filterAttr};var s=this.CallSPWebSvc(i);return s};this.WebServices.GetUserLoginFromEmail=function(e){var t=r(e);var n=t.userEmails.split(",");var i="<emailXml><Users>";for(var s=0;s<n.length;s++)i+="<User Email='"+n[s]+"'/>";i+="</Users></emailXml>";var o={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetUserLoginFromEmail",soapBody:i,returnNode:"User",filterNode:t.filterNode,filterAttr:t.filterAttr};var u=this.CallSPWebSvc(o);return u};this.WebServices.GetUserInfo=function(e){var t=r(e);var n={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetUserInfo",soapBody:"<userLoginName>"+t.userLoginName+"</userLoginName>",returnNode:"User",filterNode:t.filterNode,filterAttr:t.filterAttr};var i=this.CallSPWebSvc(n);return i};this.WebServices.GetRoleCollection=function(e){var t=r(e);var n=t.roleNames.split(",");var i="<roleNameXml><Roles>";for(var s=0;s<n.length;s++)i+="<Role RoleName='"+n[s]+"'/>";i+="</Roles></roleNameXml>";var o={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetRoleCollection",soapBody:i,returnNode:"Roles",filterNode:t.filterNode,filterAttr:t.filterAttr};var u=this.CallSPWebSvc(o);return u};this.WebServices.GetRoleInfo=function(e){var t=r(e);var n={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetRoleInfo",soapBody:"<roleName>"+t.roleName+"</roleName>",returnNode:"Role",filterNode:t.filterNode,filterAttr:t.filterAttr};var i=this.CallSPWebSvc(n);return i};this.WebServices.GetGroupCollectionFromWeb=function(e){var t=r(e);var n={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetGroupCollectionFromWeb",soapBody:"",returnNode:"Groups",filterNode:t.filterNode,filterAttr:t.filterAttr};var i=this.CallSPWebSvc(n);return i};this.WebServices.GetGroupCollectionFromSite=function(e){var t=r(e);var n={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetGroupCollectionFromSite",soapBody:"",returnNode:"Groups",filterNode:t.filterNode,filterAttr:t.filterAttr};var i=this.CallSPWebSvc(n);return i};this.WebServices.GetRoleCollectionFromWeb=function(e){var t=r(e);var n={siteUrl:t.siteUrl,serviceName:"UserGroup",operationPath:"directory",operationName:"GetRoleCollectionFromWeb",soapBody:"",returnNode:"GetRoleCollectionFromWebResult",filterNode:t.filterNode,filterAttr:t.filterAttr};var i=this.CallSPWebSvc(n);return i};this.WebServices.CallSPWebSvc=function(i){var s=r(i);var o=s.siteUrl;var u=s.serviceName;var a=s.operationName;var f=s.soapBody;var l=s.returnNode;var c=s.operationPath;var h=s.filterNode;var d=s.filterAttr;this.Result={};var v;var m={siteurl:o,service:u,operation:a,resultnode:l,success:false,errorCode:"",errorText:"jP.WebServices.CallSPWebSvc internal error",responseText:"",count:-1,data:{},xmlDoc:{}};var g="<"+a+' xmlns="http://schemas.microsoft.com/sharepoint/soap/';if(typeof c!="undefined")g+=c+"/";if(f!="")g+='">'+f+"</"+a+">";else g+='" />';var y="http://schemas.microsoft.com/sharepoint/soap/";if(typeof c!="undefined")y+=c+"/";y+=a;p(o+"/_vti_bin/"+u+".asmx",y,g,function(t){v=$(t);if(typeof t.status!="undefined"){m.success=false;m.count=-1;if(typeof t.statusText!="undefined"){m.errorCode=t.status;m.errorText=t.statusText;m.responseText=t.responseText}else{var n=$("errorcode",t.responseXML);var r=$("errorstring",t.responseXML);if(n.length>0)m.errorCode=n.text();if(r.length>0)m.errorText=r.text();m.xmlDoc=t.responseXML}}else{m.success=true;m.errorCode="0x00000000";m.errorText=null;m.xmlDoc=t;m.count=$(l,t).length;$.each($(l,t),function(t,n){if(n.nodeName!="#text"&&n.nodeName!="#cdata-section")m.data[n.nodeName+t]=e(n)})}});this.Result=m;var b=n(v,h,d);if(typeof b!="undefined")v=b;if(typeof h!="undefined"&&typeof b=="undefined")v=t;return v};var e=function(n){var r={};var i=0;try{if(n.nodeName=="#text"||n.nodeName=="#cdata-section")return t;r["NodeName"]=n.nodeName;var s={};if(n.attributes!=null){$.each(n.attributes,function(e,t){s[t.name]=t.value})}r["NodeAttr"]=s;if($.browser.msie||$.browser.chrome){i=0;var o=n.firstChild;while(o!=null){var u=e(o);if(typeof u!="undefined"){r[u.NodeName+i]=u;i++}o=o.nextSibling}r["NodeText"]=$.browser.chrome?n.textContent:n.text;r["ChildrenCount"]=i}else{$.each(n.children,function(t,n){var i=e(n);r[i.NodeName+t]=i;});r["NodeText"]=n.textContent;r["ChildrenCount"]=$(n.children).length}}catch(a){alert("WebServices.xml2Obj Error: "+a.description+"("+n.nodeName+i+")")}return r};var n=function(e,n,r){var i;if(typeof n!="underfined"&&typeof r!="undefined"){i=$(e).find(n).Attrs(r);if(i.length==0)i=t}return i};var r=function(e){var t={siteUrl:document.location.protocol+"//"+document.location.host+jP.SiteURL,webUrl:document.location};var n=$.extend(t,e);return n}};jQuery.fn.Attrs=function(e){var t=[];this.each(function(){t.push($(this).attr(e))});return t};var l=navigator.userAgent.toLowerCase();jQuery.browser={version:(l.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1],chrome:/chrome/.test(l),safari:/webkit/.test(l)&&!/chrome/.test(l),opera:/opera/.test(l),msie:/msie/.test(l)&&!/opera/.test(l),mozilla:/mozilla/.test(l)&&!/(compatible|webkit)/.test(l)};s.extend=s.fn.extend=jQuery.extend;s.extend({Form:s.Form(),Lists:s.Lists(),ListName:s.valListName(),SiteURL:s.valSiteURL(),Webparts:s.Webparts(),WebServices:s.WebServices(),includePath:"",include:function(e){var t=typeof e=="string"?[e]:e;for(var n=0;n<t.length;n++){var r=t[n].replace(/^\s|\s$/g,"");var i=r.split(".");var o=i[i.length-1].toLowerCase();var u=o=="css";var a=u?"link":"script";var f=u?" type='text/css' rel='stylesheet' ":" language='javascript' type='text/javascript' ";var l=(u?"href":"src")+"='"+s.includePath+r+"'";if($(a+"["+l+"]").length==0)document.write("<"+a+f+l+"></"+a+">")}}});s.prototype.init();s.valSiteURL();s.valListName()})();(function(e){e.config=function(t){var n=e.extend({},e.config.defaults,t);try{myjPart.Options=n;if(myjPart.ShowConfigDefaults!=null&&myjPart.Options.Local==null||$("span:contains('Add a Web Part')").length>0){var r="myjPart"+myjPart.Position;var i=$("#"+r);i.append("<div id='"+r+"info' style='display:block'></div>");i.append("<div id='"+r+"config' style='display:none'></div>");$("#"+r+"info").append("<table id='"+r+"infoTable' style='width:100%;height:100%;background-color:yellow'></table>");var s=$("#"+r+"infoTable");$.each(n.Plugin,function(e,t){s.append("<tr><td style='width:40%'>"+e+":</td><td style='width:60%'>"+t+"</td></tr>")});if(myjPart.ShowConfigDefaults!=null)s.append("<tr><td colspan='2' align='right'><input type='button' value='Options' onclick='editConfiguration(true, "+r+")'; /></td></tr>");$("#"+r+"config").append("<table id='"+r+"configTable' style='width:100%;height:100%;background-color:silver'></table>");var o=$("#"+r+"configTable");o.append("<tr><td colspan='2' align='right'><input type='button' value='Update' onclick=updateConfiguration('"+r+"'); /><input type='button' value='Cancel' onclick='editConfiguration(false, "+r+")'; /></td></tr>");myjPart.WebpartDiv=i;myjPart.InfoDiv=$("#"+r+"info");myjPart.ConfigDiv=$("#"+r+"config");myjPart.ConfigTableDiv=o}if(myjPart.Options.Plugin.Name!=null)myjParts[myjPart.Options.Plugin.Name]=myjPart;myjPart["MainDiv"]=$("#"+myjPart.MainDivID)}catch(u){}};editConfiguration=function(e,t){if(e){$("#"+t.id+"info").hide();myjParts[parseInt(t.id.replace("myjPart",""))].showConfig();$("#"+t.id+"config").show()}else{$("#"+t.id+"info").show();$("#"+t.id+"config").hide()}};updateConfiguration=function(t){var n=myjParts[parseInt(t.replace("myjPart",""))];n.readConfig();if(n.Options.Local!=null){var r=e.Webparts.getPageWebPartProperties(location.href,$($("#"+t)[0].parentNode).attr("WebpartID"));var i="{";$.each(n.Options.Local,function(e,t){if(i.length>1)i+=",";if(typeof t=="string")i+=e+":'"+t+"'";else i+=e+":"+t});i+="}";e.Webparts.updatejPartProperties(r,i)}else{alert("Webpart's Local options are not defined")}}})(jPoint)
